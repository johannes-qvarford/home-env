#!/bin/bash
set -e

# Pre-commit hook for home-env-mcp
# Checks formatting and runs tests before allowing commits

# Navigate to the MCP project directory
cd "$(dirname "$0")/../../home-env-mcp"

echo "Running pre-commit checks for home-env-mcp..."

# Check if we're in the correct directory
if [ ! -f "pom.xml" ]; then
    echo "Error: Not in home-env-mcp directory"
    exit 1
fi

# Run Maven formatter check
echo "Checking code formatting..."
if ! mvn spotless:check -q; then
    echo "❌ Code formatting check failed!"
    echo "Run 'mvn spotless:apply' to fix formatting issues."
    exit 1
fi
echo "✅ Code formatting check passed"

# Run tests
echo "Running tests..."
if ! mvn test -q; then
    echo "❌ Tests failed!"
    exit 1
fi
echo "✅ All tests passed"

echo "✅ Pre-commit checks completed successfully"